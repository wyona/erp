<?xml version="1.0"?>

<map:sitemap xmlns:map="http://apache.org/cocoon/sitemap/1.0">

  <map:components>
    <map:generators default="file">
      <map:generator logger="sitemap.generator.traversable" name="traversable" src="org.apache.cocoon.generation.TraversableGenerator"/>
    </map:generators>
  </map:components>

  <map:pipelines>
    <map:pipeline>
      <map:match pattern="authoring/">
        <map:redirect-to uri="index.html"/>
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="*/index.html">
        <map:generate src="index.xhtml"/>
        <map:match pattern="authoring/index.html">
          <map:select type="browser">
            <map:when test="mozilla5">
              <map:transform src="cocoon://lenya-page/{page-envelope:publication-id}/{../1}/homepage.xml?uiml=xul"/>
              <map:serialize type="xml" mime-type="application/vnd.mozilla.xul+xml"/>
            </map:when>
            <map:otherwise>
              <map:transform src="cocoon://lenya-page/{page-envelope:publication-id}/{../1}/homepage.xml"/>
              <map:transform src="../../xslt/util/strip_namespaces.xsl"/>
              <map:serialize type="xhtml"/>
            </map:otherwise>
          </map:select>
        </map:match>
<!--
        <map:transform src="../../xslt/util/strip_namespaces.xsl"/>
        <map:serialize type="xhtml"/>
-->
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="*/erp.xtm">
        <map:generate src="erp.xtm"/>
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="*/tasks/introspection.xml">
        <map:generate src="introspection-tasks.xml"/>
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="*/tasks/task-*">
        <map:generate src="jcr://tasks/task-{2}" type="traversable" />
	<!--
        <map:generate type="traversable" src="jcr://tasks/task-1123859887996"/>
	-->
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="*/tasks**">
        <map:generate type="traversable" src="jcr://tasks">
          <map:parameter name="depth" value="3"/>
          <map:parameter name="refreshDelay" value="0"/>
        </map:generate>
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="*/projects**">
        <map:generate type="traversable" src="jcr://projects"/>
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="*/persons**">
        <map:generate type="traversable" src="jcr://persons"/>
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="*/customers**">
        <map:generate type="traversable" src="jcr://companies"/>
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>

    <map:pipeline>
      <map:match pattern="*/invoices**">
        <map:generate type="traversable" src="jcr://invoices"/>
        <map:serialize type="xml"/>
      </map:match>
    </map:pipeline>

  </map:pipelines>
</map:sitemap>
